import{d as M,aW as Y,t as g,Y as H,S as R,ae as W,ai as X,o as _,C,H as e,e as n,w as a,F as x,aX as Z,a5 as G,y as L,D as h,z as A,a1 as p,aM as K,a as I,B as z,am as B,aY as Q,aV as f,aZ as ee,a_ as te,a2 as ae,a3 as le,a4 as se}from"./index-795d7c35.js";import{E as re,a as ne}from"./el-table-column-3c81f00b.js";import"./el-tooltip-4ed993c7.js";import{E as oe}from"./el-message-2d0f4628.js";import{E as ie}from"./el-button-5e2ad253.js";const ce=["onClick"],ge=M({__name:"index",setup(de){let m=Y(),v=g([]),c=g(0);g(!0);let t=H({attrName:"",attrValueList:[],categoryId:"",categoryLevel:3}),b=g([]);R(()=>m.c3Id,()=>{v.value=[],m.c3Id&&V()});const V=async()=>{const{c1Id:s,c2Id:i,c3Id:y}=m;let r=await Z(s,i,y);r.code===200&&(v.value=r.data)},S=()=>{Object.assign(t,{attrName:"",attrValueList:[],categoryId:m.c3Id,categoryLevel:3}),c.value=1},$=s=>{c.value=1,Object.assign(t,JSON.parse(JSON.stringify(s)))},N=()=>{c.value=0},D=()=>{t.attrValueList.push({valueName:"",flag:!0}),B(()=>{b.value[t.attrValueList.length-1].focus()})},O=async()=>{(await Q(t)).code===200?(c.value=0,f({type:"success",message:t.id?"修改成功":"添加成功"}),V()):f({type:"error",message:t.id?"修改失败":"添加失败"})},T=(s,i)=>{if(s.valueName.trim()===""){t.attrValueList.splice(i,1),f({type:"error",message:"属性值不能为空"});return}if(t.attrValueList.find(r=>{if(r!==s)return r.valueName===s.valueName})){t.attrValueList.splice(i,1),f({type:"error",message:"属性值不能重复"});return}s.flag=!1},U=(s,i)=>{s.flag=!0,B(()=>{b.value[i].focus()})},F=async s=>{(await ee(s)).code===200?(f({type:"success",message:"删除成功"}),V()):f({type:"error",message:"删除失败"})};return W(()=>{m.$reset()}),(s,i)=>{const y=X("def-category"),r=ie,d=re,P=te,q=oe,k=ne,E=ae,j=le,w=se,J=G;return _(),C(x,null,[e(y,{scene:n(c)},null,8,["scene"]),e(J,{style:{margin:"10px 0"}},{default:a(()=>[L(A("div",null,[e(r,{type:"primary",size:"default",icon:"Plus",disabled:!n(m).c3Id,onClick:S},{default:a(()=>[p(" 添加平台属性 ")]),_:1},8,["disabled"]),e(k,{border:"",style:{margin:"10px 0"},data:n(v)},{default:a(()=>[e(d,{label:"序号",type:"index",align:"center",width:"80px"}),e(d,{label:"属性名称",prop:"attrName"}),e(d,{label:"属性值名称"},{default:a(({row:l,$index:u})=>[(_(!0),C(x,null,K(l.attrValueList,(o,ue)=>(_(),I(P,{style:{margin:"5px"},key:o.id},{default:a(()=>[p(z(o.valueName),1)]),_:2},1024))),128))]),_:1}),e(d,{label:"操作"},{default:a(({row:l,$index:u})=>[e(r,{type:"primary",size:"small",icon:"Edit",onClick:o=>$(l)},null,8,["onClick"]),e(q,{title:`你确定删除${l.attrName}?`,width:"200px",onConfirm:o=>F(l.id)},{reference:a(()=>[e(r,{type:"danger",size:"small",icon:"Delete"})]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"])],512),[[h,n(c)===0]]),L(A("div",null,[e(w,{inline:!0},{default:a(()=>[e(j,{label:"属性名称"},{default:a(()=>[e(E,{placeholder:"请你输入属性名称",modelValue:n(t).attrName,"onUpdate:modelValue":i[0]||(i[0]=l=>n(t).attrName=l)},null,8,["modelValue"])]),_:1})]),_:1}),e(r,{disabled:!n(t).attrName,type:"primary",size:"default",icon:"Plus",onClick:D},{default:a(()=>[p(" 添加属性值 ")]),_:1},8,["disabled"]),e(r,{size:"default",onClick:N},{default:a(()=>[p("取消")]),_:1}),e(k,{border:"",style:{margin:"10px 0"},data:n(t).attrValueList},{default:a(()=>[e(d,{label:"序号",width:"80px",type:"index",align:"center"}),e(d,{label:"属性值名称"},{default:a(({row:l,$index:u})=>[l.flag?(_(),I(E,{key:0,ref:o=>n(b)[u]=o,placeholder:"请你输入属性值名称",modelValue:l.valueName,"onUpdate:modelValue":o=>l.valueName=o,onBlur:o=>T(l,u)},null,8,["modelValue","onUpdate:modelValue","onBlur"])):(_(),C("div",{key:1,onClick:o=>U(l,u)},z(l.valueName),9,ce))]),_:1}),e(d,{label:"属性值操作"},{default:a(({row:l,$index:u})=>[e(r,{type:"danger",size:"small",icon:"Delete",onClick:o=>n(t).attrValueList.splice(u,1)},null,8,["onClick"])]),_:1})]),_:1},8,["data"]),e(r,{type:"primary",size:"default",onClick:O,disabled:!(n(t).attrValueList.length>0)},{default:a(()=>[p(" 保存 ")]),_:1},8,["disabled"]),e(r,{size:"default",onClick:N},{default:a(()=>[p("取消")]),_:1})],512),[[h,n(c)===1]])]),_:1})],64)}}});export{ge as default};
