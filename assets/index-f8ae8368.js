import{aT as C,d as Q,t as i,c as de,ai as X,o as S,a as E,w as s,H as e,e as l,C as F,aM as j,F as H,aU as T,z as Y,a1 as w,B as pe,aV as N,am as ce,a2 as me,a3 as _e,b0 as ge,b1 as fe,E as Se,a_ as ve,a4 as ye,U as be,aW as Ae,S as Ve,a5 as Ue,y as K,D as R}from"./index-8341741e.js";import{b as Ie,E as xe,a as ke}from"./el-pagination-e1f3e04a.js";import{E as Z,a as ee}from"./el-message-4f3be1f1.js";import"./el-tooltip-4ed993c7.js";import{E as ae}from"./el-button-247a7d77.js";import"./el-icon-ba31f5ee.js";const Pe=(d,m,p)=>C.get(`/admin/product/${d}/${m}?category3Id=${p}`),J=()=>C.get("/admin/product/baseTrademark/getTrademarkList"),Ce=d=>C.get("/admin/product/spuImageList/"+d),he=d=>C.get("/admin/product/spuSaleAttrList/"+d),W=()=>C.get("/admin/product/baseSaleAttrList"),Ee=d=>d.id?C.post("/admin/product/updateSpuInfo",d):C.post("/admin/product/saveSpuInfo",d),ze=["src"],Le=Q({__name:"spuForm",emits:["changeScene"],setup(d,{expose:m,emit:p}){let r=i("");const U=()=>{p("changeScene",{flag:0,params:"update"})};let h=i([]),_=i([]),c=i([]),v=i([]),I=i(!1),B=i(""),u=i({category3Id:"",spuName:"",description:"",tmId:"",spuImageList:[],spuSaleAttrList:[]}),D=i([]);const y=async n=>{u.value=n;let t=await J(),o=await Ce(n.id),f=await he(n.id),z=await W();h.value=t.data,_.value=o.data.map(k=>({name:k.imgName,url:k.imgUrl})),c.value=f.data,v.value=z.data},g=n=>{B.value=n.url,I.value=!0},$=()=>{},x=n=>n.type==="image/png"||n.type==="image/jpeg"||n.type==="image/gif"?n.size/1024/1024<3?!0:(N({type:"error",message:"上传文件务必小于3M"}),!1):(N({type:"error",message:"上传文件务必PNG|JPG|GIF"}),!1);let A=de(()=>v.value.filter(t=>c.value.every(o=>t.name!==o.saleAttrName)));const M=()=>{const[n,t]=r.value.split(":");let o={baseSaleAttrId:n,saleAttrName:t,spuSaleAttrValueList:[]};c.value.push(o),r.value=""},G=(n,t)=>{n.flag=!0,n.saleAttrValue="",ce(()=>{D.value[t].focus()})},O=n=>{const{baseSaleAttrId:t,saleAttrValue:o}=n;let f={baseSaleAttrId:t,saleAttrValueName:o};if((o==null?void 0:o.trim())===""){N({type:"error",message:"属性值不能为空的"});return}if(n.spuSaleAttrValueList.find(k=>k.saleAttrValueName===o)){N({type:"error",message:"属性值重复"});return}n.spuSaleAttrValueList.push(f),n.flag=!1},b=async()=>{u.value.spuImageList=_.value.map(t=>({imgName:t.name,imgUrl:t.response&&t.response.data||t.url})),u.value.spuSaleAttrList=c.value,(await Ee(u.value)).code===200&&(N({type:"success",message:u.value.id?"更新成功":"添加成功"}),p("changeScene",{flag:0,params:u.value.id?"update":"add"}))};return m({initHasSpuData:y,initAddSpu:async n=>{Object.assign(u.value,{category3Id:"",spuName:"",description:"",tmId:"",spuImageList:[],spuSaleAttrList:[]}),_.value=[],c.value=[],r.value="",u.value.category3Id=n;let t=await J(),o=await W();h.value=t.data,v.value=o.data}}),(n,t)=>{const o=me,f=_e,z=ge,k=fe,le=X("Plus"),ne=Se,se=Ie,oe=xe,L=ae,q=Z,re=ve,ue=ee,ie=ye;return S(),E(ie,{"label-width":"100px"},{default:s(()=>[e(f,{label:"SPU名称"},{default:s(()=>[e(o,{placeholder:"请你输入SPU名称",modelValue:l(u).spuName,"onUpdate:modelValue":t[0]||(t[0]=a=>l(u).spuName=a)},null,8,["modelValue"])]),_:1}),e(f,{label:"SPU品牌"},{default:s(()=>[e(k,{modelValue:l(u).tmId,"onUpdate:modelValue":t[1]||(t[1]=a=>l(u).tmId=a)},{default:s(()=>[(S(!0),F(H,null,j(l(h),(a,P)=>(S(),E(z,{label:a.tmName,value:a.id},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:1}),e(f,{label:"SPU描述"},{default:s(()=>[e(o,{type:"textarea",placeholder:"请你输入SPU描述",modelValue:l(u).description,"onUpdate:modelValue":t[2]||(t[2]=a=>l(u).description=a)},null,8,["modelValue"])]),_:1}),e(f,{label:"SPU图标"},{default:s(()=>[e(se,{"file-list":l(_),"onUpdate:fileList":t[3]||(t[3]=a=>T(_)?_.value=a:_=a),action:"/api/admin/product/fileUpload","list-type":"picture-card","on-preview":g,"on-remove":$,"before-upload":x},{default:s(()=>[e(ne,null,{default:s(()=>[e(le)]),_:1})]),_:1},8,["file-list"]),e(oe,{modelValue:l(I),"onUpdate:modelValue":t[4]||(t[4]=a=>T(I)?I.value=a:I=a)},{default:s(()=>[Y("img",{"w-full":"",src:l(B),alt:"Preview Image",style:{width:"100%",height:"100%"}},null,8,ze)]),_:1},8,["modelValue"])]),_:1}),e(f,{label:"SPU销售属性"},{default:s(()=>[e(k,{modelValue:l(r),"onUpdate:modelValue":t[5]||(t[5]=a=>T(r)?r.value=a:r=a),placeholder:l(A).length?`还未选择${l(A).length}个`:"暂无数据可选择"},{default:s(()=>[(S(!0),F(H,null,j(l(A),(a,P)=>(S(),E(z,{label:a.name,key:a.id,value:`${a.id}:${a.name}`},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),e(L,{style:{"margin-left":"10px"},type:"primary",size:"default",icon:"Plus",disabled:!l(r),onClick:M},{default:s(()=>[w(" 添加属性 ")]),_:1},8,["disabled"]),e(ue,{border:"",style:{margin:"10px 0"},data:l(c)},{default:s(()=>[e(q,{label:"序号",type:"index",align:"center",width:"80px"}),e(q,{label:"销售属性名字",width:"120px",prop:"saleAttrName"}),e(q,{label:"销售属性值"},{default:s(({row:a,$index:P})=>[(S(!0),F(H,null,j(a.spuSaleAttrValueList,(V,Be)=>(S(),E(re,{key:a.id,class:"mx-1",closable:"",style:{margin:"0 8px"},onClose:De=>a.spuSaleAttrValueList.splice(P,1)},{default:s(()=>[w(pe(V.saleAttrValueName),1)]),_:2},1032,["onClose"]))),128)),a.flag===!0?(S(),E(o,{key:0,ref:V=>l(D)[P]=V,modelValue:a.saleAttrValue,"onUpdate:modelValue":V=>a.saleAttrValue=V,placeholder:"请你输入属性值",size:"small",style:{width:"100px"},onBlur:V=>O(a)},null,8,["modelValue","onUpdate:modelValue","onBlur"])):(S(),E(L,{key:1,size:"small",icon:"Plus",onClick:V=>G(a,P)},null,8,["onClick"]))]),_:1}),e(q,{label:"操作",width:"120px"},{default:s(({row:a,$index:P})=>[e(L,{type:"danger",size:"small",icon:"Delete",onClick:V=>l(c).splice(P,1)},null,8,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),e(f,null,{default:s(()=>[e(L,{type:"primary",size:"default",onClick:b,disabled:!(l(c).length>0)},{default:s(()=>[w(" 保存 ")]),_:1},8,["disabled"]),e(L,{size:"default",onClick:U},{default:s(()=>[w("取消")]),_:1})]),_:1})]),_:1})}}}),Ne={};function we(d,m){return null}const Te=be(Ne,[["render",we]]),Oe=Q({__name:"index",setup(d){let m=Ae(),p=i(0),r=i(1),U=i(3),h=i([]),_=i(0),c=i();Ve(()=>m.c3Id,()=>{m.c3Id&&v()});const v=async(y=1)=>{r.value=y;let g=await Pe(r.value,U.value,m.c3Id);g.code===200&&(h.value=g.data.records,_.value=g.data.total)},I=()=>{v()},B=()=>{p.value=1,c.value.initAddSpu(m.c3Id)},u=y=>{p.value=y.flag,y.params=="update"?v(r.value):v()},D=y=>{p.value=1,c.value.initHasSpuData(y)};return(y,g)=>{const $=X("def-category"),x=ae,A=Z,M=ee,G=ke,O=Ue;return S(),F(H,null,[e($,{scene:l(p)},null,8,["scene"]),e(O,{style:{margin:"10px 0"}},{default:s(()=>[K(Y("div",null,[e(x,{type:"primary",size:"default",icon:"Plus",disabled:!l(m).c3Id,onClick:B},{default:s(()=>[w(" 添加SPU ")]),_:1},8,["disabled"]),e(M,{style:{margin:"10px 0"},border:"",data:l(h)},{default:s(()=>[e(A,{label:"序号",align:"center",width:"80px",type:"index"}),e(A,{label:"SPU名称",prop:"spuName"}),e(A,{label:"SPU描述",prop:"description","show-overflow-tooltip":""}),e(A,{label:"SPU操作"},{default:s(({row:b,$index:te})=>[e(x,{icon:"Plus",title:"添加SKU",size:"small"}),e(x,{type:"primary",icon:"Edit",title:"修改SPU",size:"small",onClick:n=>D(b)},null,8,["onClick"]),e(x,{type:"info",icon:"View",title:"查看SKU列表",size:"small"}),e(x,{type:"danger",icon:"Delete",title:"删除SPU",size:"small"})]),_:1})]),_:1},8,["data"]),e(G,{"current-page":l(r),"onUpdate:currentPage":g[0]||(g[0]=b=>T(r)?r.value=b:r=b),"page-size":l(U),"onUpdate:pageSize":g[1]||(g[1]=b=>T(U)?U.value=b:U=b),"page-sizes":[3,5,7,9],background:!0,layout:"prev, pager, next, jumper, ->, sizes, total",total:l(_),onCurrentChange:v,onSizeChange:I},null,8,["current-page","page-size","total"])],512),[[R,l(p)===0]]),K(e(Le,{ref_key:"spu",ref:c,onChangeScene:u},null,512),[[R,l(p)===1]]),K(e(Te,{ref:"sku"},null,512),[[R,l(p)===2]])]),_:1})],64)}}});export{Oe as default};
